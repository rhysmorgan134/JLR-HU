<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="description"
      content="jMuxer - a simple javascript mp4 muxer for non-standard streaming communications protocol"
    />
    <meta name="keywords" content="h264 player, mp4 player, mse, mp4 muxing, jmuxer, aac player" />
    <title>jMuxer demo</title>
  </head>
  <body>
    <div id="container" style="margin: 0 auto; text-align: center">
      <video
        style="border: 1px solid #333; max-width: 500px"
        controls
        autoplay
        poster="images/loader-thumb.jpg"
        id="player"
      ></video>
    </div>
    <script>
      function parse(data) {
        var input = new Uint8Array(data),
          dv = new DataView(input.buffer),
          duration,
          video

        duration = dv.getUint32(0, true)
        video = input.subarray(4)

        return {
          video: video,
          duration: duration
        }
      }

      window.onload = function () {
        var socketURL = 'ws://localhost:3001'
        const jmuxer = new JMuxer({
          node: 'player',
          mode: 'video',
          maxDelay: 100,
          fps: 60,
          flushingTime: 100,
          debug: false
        })

        var ws = new WebSocket(socketURL)
        ws.binaryType = 'arraybuffer'
        ws.addEventListener('message', function (event) {
          var data = parse(event.data)
          jmuxer.feed(data)
        })

        ws.addEventListener('error', function (e) {
          console.log('Socket Error')
        })
      }
    </script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/jmuxer@2.0.3/dist/jmuxer.min.js"
    ></script>
  </body>
</html>
